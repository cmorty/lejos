<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
  <title>Getting Started on Linux</title>
  <!-- CSS -->
  <link rel="stylesheet" href="../r_css/lejos-tutorial.css" type="text/css" /><!-- ICONO -->
  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
</head>
<body>
<a id="top" name="top"></a>
<!-- N1: HEADER -->
<table class="n1t1" cellpadding="0" cellspacing="0">
  <tbody>
    <tr>
      <td><img src="../r_media/images/tutorial_header1.jpg" /></td>
      <td align="right"><img src="../r_media/images/tutorial_header2.jpg" /></td>
    </tr>
  </tbody>
</table>
<!-- N2: CONTENTS -> NAVIGATION SYSTEMS AND CONTENTS -->
<table class="n2t1" cellpadding="0" cellspacing="0">
  <tbody>
    <tr>
      <td class="n2t1r1c1">
      <div class="nolinkLESSON">Getting Started on Linux</div>
      <div class="linkAHEAD"><a href="#1">Prerequisites</a></div>
      <div class="linkAHEAD2"><a href="#2">Java Development Kit</a></div>
      <div class="linkAHEAD2"><a href="#3">libusb</a></div>
      <div class="linkAHEAD2"><a href="#4">Package dependencies</a></div>
      <div class="linkAHEAD2"><a href="#5">Accessing USB Devices</a></div>
      <div class="linkAHEAD2"><a href="#6">Bluetooth</a></div>
      <div class="linkAHEAD"><a href="#7">Downloading the software</a></div>
      <div class="linkAHEAD"><a href="#8">Installing the software</a></div>
      <div class="linkAHEAD2"><a href="#9">Unpacking the release</a></div>
      <div class="linkAHEAD2"><a href="#10">Setting up environment variables</a></div>
      <div class="linkAHEAD2"><a href="#11">Building the release</a></div>
      <div class="linkAHEAD2"><a href="#12">Flashing the firmware</a></div>
      <div class="linkAHEAD"><a href="#13">Testing your Installation</a></div>
      <div class="linkAHEAD2"><a href="#14">Compiling and running your first program</a></div>
      </td>
      <td>
        <div id="BreadCrumbs">
            <a href="../index.htm" target="_top">Home Page</a>&gt;
            <a href="#">Getting Started on Linux</a>
        </div>
      <div class="NavBit"> <a target="_top" href="../Preliminaries/Intro.htm">«&nbsp;Previous</a>&nbsp;&#8226;&nbsp;
      <a href="../index.htm">TOC</a>&nbsp;&#8226;&nbsp;<a href="../Preliminaries/FirstProgram.htm">Next&nbsp;»</a> </div>
      <div id="PageTitle">Getting Started on Linux</div>
      <p>This version of the tutorial is for the 0.9 release of leJOS NXJ. </p>
      <a name="1"></a>
      <h4>Prerequisites</h4>
      
      <a name="2"></a>
      <h5>Java Development Kit</h5>     
      <p>You will also need a Java Development Kit (JDK) on your PC. 
      Note that a Java Runtime Environment (JRE) is not sufficient 
      as it does not allow you to compile Java programs. You can download
      the latest JDK from <a href="http://www.oracle.com/technetwork/java/index.html" target="_blank">http://www.oracle.com/technetwork/java/index.html</a>.
      Follow the instructions for installing it. leJOS NXJ works has been
      tested with JDK versions 1.5 and 1.6, but will not work with earlier
      versions. JDK 1.6 is recommended as some PC samples do not work with JDK 1.5. Note that leJOS has only
      been tested with the official Oracle JDK. It is likely to work with the Open JDK, but not with gcj.</p>
      <p>You will need to add the JDK bin directory to your system or user PATH,
       so that commands such as <code>javac</code> and <code>java</code> can be called from a command prompt. If you do not know how to do this, 
       see <a href="#11">Setting up environment variables</a> below.</p>
       <p> You should set the environment variable JAVA_HOME to the folder where you installed the JDK. If you have multiple JDKs installed and do
       not want to have JAVA_HOME, you can set LEJOS_NXT_JAVA_HOME instead.</p>
 
      <a name="3"></a>
      <h5>libusb</h5>  
      
      <p>In order to use a USB connection to your NXT brick on Linux, you will need libusb installed on your sysyem. 
      leJOS requires the legacy 0.1.12 release. On most Linux distributions the 0.1.12 version of the libusb package will normally be installed, but the libusb development package may not be.. You can get more information from <a href="http://libusb.sourceforge.net" target="_blank">http://libusb.sourceforge.net</a></p>
               
      <a name="4"></a>
      <h5>Package Dependencies</h5> 
      
       <p>You  will need to ensure that the packages that leJOS NXJ is dependent on are on your system. 
       	To build the jlibnxt JNI library, which is used for USB access, you need the <em>Development files for libusb (libusb-devel)</em>.  
       	Note that leJOS NXJ uses libusb (legacy release 0.1.12), not libusb1.</p>
         
      <a name="5"></a>
      <h5>Accessing USB devices</h5>
      
      <p>If you are running leJOS NXJ from a non-root user, you will need to ensure that you have read and write access the NXT USB device in /dev/bus/usb.
		If you can identify the device in /dev/bus/usb, you can do this by:</p>

		<p><em>sudo chmod a+w /dev/bus/usb/xxx/yyy</em></p>

		<p>However, the yyy number will count up each time the NXT is disconnected and reconnected.</p>

		<p>A better solution is to use <em>udev rules</em>. How to do this may vary with different Linux systems.</p>

		<p>To use <em>udev rules</em>, set up a file such as  <em>/etc/udev/rules.d/70-lego.rules</em> and populate it with the following lines:</p>

		<code>
		# Lego NXT<br/>
		BUS=="usb", SYSFS{idVendor}=="03eb", GROUP="lego", MODE="0660" <br/>
		BUS=="usb", SYSFS{idVendor}=="0694", GROUP="lego", MODE="0660" <br/>
		</code>

		<p>This relies on the username you are using being in the <em>lego</em> group. You can modify the file to your
		requirements. The two vendors are LEGO and Atmel (for the samba driver used in firmware update mode).
		You may need to reload the rules or restart udev. On some Linux systems, the command to reload the rules is <em>udevadm control --reload-rules</em>.</p>
                 
      <a name="6"></a>
      <h5>Bluetooth</h5> 
      <p> If you want to communicate with the NXT over Bluetooth, you will need a Linux supported Bluetooth dongle or built-in support on your PC. 
      leJOS uses the Bluecove libraries which are included in the distribution.
       </p>
       
      <p> You can use leJOS NXJ without Bluetooth.</p>
      
      <p> <a href="#top">Back to top</a> </p>
      
      <a name="7"></a>
      <h4>Downloading the software</h4> 
      <p>You can download the leJOS NXJ software from <a href="http://lejos.sourceforge.net/nxj-downloads.php" target="_blank">
      The leJOS NXJ download page</a>.</p>
      <p>On Linux, leJOS is distributed as a .tar.gz file.</p>
      
      <p> <a href="#top">Back to top</a> </p>
      
      <a name="8"></a>
      <h4>Installing leJOS</h4>
      
      <a name="9"></a>
      <h5>Unpacking the release</h5>
      <p>Unpack the release into a directory of your choice, e.g. /opt/lejos/</p>
      
      <a name="10"></a>
      <h5>Setting up environment variables</h5>
      <p>You need to set:</p>
      <table border="1">
        <tbody>
          <tr>
            <td><b>Variable</b></td>
            <td><b>Value</b></td>
            <td><b>Example</b></td>
          </tr>
          <tr>
            <td>NXJ_HOME</td>
            <td>The folder you installed leJOS NXJ into</td>
            <td>/opt/lejos_nxj</td>
          </tr>
          <tr>
            <td>JAVA_HOME</td>
            <td>The folder  where you installed the JDK </td>
            <td>/usr/java/</td>
          </tr>
          <tr>
            <td>PATH</td>
            <td>Add the bin folders for the JDK and leJOS</td>
            <td>$PATH:$JAVA_HOME/bin:$NXJ_HOME/bin</td>
          </tr>
        </tbody>
      </table>
      <p>Note that you can set LEJOS_NXT_JAVA_HOME if you prefer. The bin directory for the JDK may already be on your PATH.</p>
      <p>With most Linux distributions, you can set these environment variables for the current user in .bash_profile or for all users in /etc/profile.
      </p>
      
      <p>You should check that the contents of the $NXJ_HOME/bin directory to check that all the files have execute permission, and set it if if it is not set.</p>
 
       <a name="13"></a>     
      <h5>Building the release</h5>
      
      <p>To build the release, change directory to lejos_nxj/build and type <code>ant</code>. If you have the dependent packages installed
      the release should build without errors.</p>
         
      <a name="12"></a>     
      <h5>Flashing the Firmware</h5>
      
      <p>As leJOS NXJ is a firmware replacement, you will need to flash the firmware to your NXT. 
      Note that this will overwrite any existing firmware. If you have the standard LEGO firmware or other third-party firmware on your NXT, existing files will be lost.
      </p>
      
      <p>Note that the 0.9 release changes the amount of flash memory reserved for the firmware and the startup menu, so when you 
      first flash the 0.9 firmware any existing files will be lost </p>
      
      <p>Make sure your NXT is attached to the PC by its USB cable, and switch it on by pressing the orange button.</p>
      
      <p>You can either use the command line <b>nxjflash</b> command or the <b>nxjflashg</b> GUI program.</p>
      
      <p>Using the command line:</p>
      
      <p>Type <code>nxjflash</code> to flash the leJOS NXJ firmware.  
      You will see some messages on your command window.
      If your NXT has a previous version of the leJOS or LEGO firmware on it, a list of the NXTs connected to the USB will be shown, 
      and you will be asked to input the number in the list of the NXT you want updated - this will be 1 if a single NXT is connected to your PC. 
      If your NXT has other firmware on it, or if <b>nxjflash</b> fails, you must put your NXT into firmware update mode. 
      Press the reset button (at the back of the NXT , upper left corner) for more than 4 seconds. 
      A straightened paper clip could be useful for this. Your NXT will audibly tick when it is firmware update mode. 
      Then try <b>nxjflash</b> again. When flashing is successful, your NXT will reboot with the 0.9 version of the menu.
      </p>
      
      <p>Using the GUI version:</p>
      
      <p>To run the GUI version type <code>nxjflashg</code>. When the
      program window opens, click on Start Program and follow the instructions. 
      A more complete explanation is in the <a href="../PC_GUI\PCGUITools.htm">PC GUI Tools</a> tutorial page.
      </p>
      
      <p> <a href="#top">Back to top</a> </p>
      
      <a name="13"></a>
      <h4>Testing your Installation</h4>
      <p> You can check that you have successfully installed leJOS NXJ on your PC and your NXT by compiling and running your first program.</p>
      
      <a name="14"></a>
      <h5>Compiling and running your first program</h5>
      <p> Java programs need to be compiled to class files before they
      can be run. For leJOS NXJ, all the class files that are to be run on
      the NXT needed to be linked to produce a binary file (with the
      extension .nxj) and this must then be uploaded to the NXT. 
      </p>
      <p> To run a sample program, such as the View.java sample, follow these steps: </p>
       Start a shell session, and change directory to the lejos_nxj/projects/samples/View folder: 
      <p> Compile the program with the nxjc command: </p>
      <pre><code> nxjc View.java </code></pre>
      <p> Then link, upload and run it with the nxj command: </p>
      <pre><code> nxj -r View </code></pre>
      <p> You should see the menu of the View sample on your NXT. </p>
      
      <p> <a href="#top">Back to top</a> </p>
      
      <div class="NavBit"> <a target="_top" href="../Preliminaries/Intro.htm">«&nbsp;Previous</a>&nbsp;&#8226;&nbsp;
      <a href="../index.htm">TOC</a>&nbsp;&#8226;&nbsp;<a href="../Preliminaries/FirstProgram.htm">Next&nbsp;»</a> </div>
      </td>
      <td> <br />
      </td>
    </tr>
  </tbody>
</table>
</body>
</html>